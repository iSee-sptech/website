<!DOCTYPE html>
<html lang="pt">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="shortcut icon" href="../assets/img/iconLogo.ico" type="image/x-icon" />
  <title>Alertas - ISee</title>
  <link rel="stylesheet" href="../css/styleModal.css">
  <link rel="stylesheet" href="../css/alertas.css" />
  <link rel="stylesheet" href="../css/NavBarSemDescricao.css" />
  <link rel="stylesheet" href="../css/efeitoToltipDescricao.css" />

</head>

<body onload="imgUsuario(), carregarDiaAtual(), carregarAlertas(), exibirQtdTotalAlertasDoDia(), exibirQtdTotalCaixasRam(), exibirQtdTotalCaixasCpu(), exibirQtdTotalCaixasDisco()">

  <div class="body_dashboard">


    <div class="sessao_grafico_principal">
      <div class="container_title">
        <h1>Alertas</h1>
        <h6 id="bem_vindo">Bom dia</h6> 

        <div id="imagem_user" class="notificacoes">
          <img src="../assets/img/alert.svg">
          <img src="../assets/img/user.svg">
        </div>

        <div class="filtro">
          <label for="input_filtro_data">
            <h2>Filtro</h2>
          </label>
          <input type="date" placeholder="data inicial" id="input_filtro_data">
          <button onclick="filtrarData()" class="buttonContact">Filtrar</button>
        </div>

      </div>

      <div class="container_tipos_alertas">

        <!----EXEMPLO DE UM CARD ALERTA--------------------------------------------------------->
        <div class="card_alerta" onclick="aparecerModalAlerta(modalAlertaUm)">
          <!--FUNCAO RECEBE ID DO MODAL-->
          <img src="../assets/img/ilustracao_alerta_ram.svg" class="ilustracao">
          <div class="corpo_alerta">
            <h2>RAM</h2>
            <h6>uso maior que 70% - nivel Amarelo <br>
                uso maior que 80% - nivel Vermelho</h6>
                Verifique os processos que estão ativos em sua máquina.
          </div>
          <div class="corpo_quantidade">
            <h2 class="qtd_caixas_tipo_alerta" id="qtd_caixas_ram">XX</h2>
            caixas
          </div>
        </div>
        <!----FIM DE UM CARD ALERTA--------------------------------------------------------->

        <div class="card_alerta" onclick="aparecerModalAlerta(modalAlertaDois)">
          <!--FUNCAO RECEBE ID DO MODAL-->
          <img src="../assets/img/ilustracao_alerta_cpu.svg" class="ilustracao">
          <div class="corpo_alerta">
            <h2>CPU</h2>
            <h6>uso maior que 60% - nivel Amarelo <br>
              uso maior que 80% - nivel Vermelho</h6>
            Verifique os processos executados por sua máquina.
          </div>
          <div class="corpo_quantidade">
            <h2 class="qtd_caixas_tipo_alerta" id="qtd_caixas_cpu">XX</h2>
            caixas
          </div>
        </div>

        <div class="card_alerta" onclick="aparecerModalAlerta(modalAlertaTres)">
          <!--FUNCAO RECEBE ID DO MODAL-->
          <img src="../assets/img/ilustracao_alerta_reserva2.svg" class="ilustracao">
          <div class="corpo_alerta">
            <h2>Disco</h2>
            <h6>uso maior que 70% - nivel Amarelo <br>
                uso maior que 90% - nivel Vermelho</h6>
              Verifique aplicativos e arquivos presentes em sua máquina.
          </div>
          <div class="corpo_quantidade">
            <h2 class="qtd_caixas_tipo_alerta" id="qtd_caixas_disco">XX</h2>
            caixas
          </div>
        </div>
<!-- 
        <div class="card_alerta" onclick="aparecerModalAlerta(modalAlertaQuatro)">
          <img src="../assets/img/ilustracao_alerta_reserva.svg" class="ilustracao">
          <div class="corpo_alerta">
            <h2>titulo</h2>
            <h6>Aqui fica o subtitulo - subtitulo</h6>
            descricao teste para ver até onde a descricao vai para pois e um texte de css
          </div>
          <div class="corpo_quantidade">
            <h2 class="qtd_caixas_tipo_alerta">XX</h2>
            caixas
          </div>
        </div> -->





      </div>
    </div>
  </div>

  <!--NavBar-->
  <div class="container_navbar">
    <div class="navbar_bottom">
      <div class="btn_home" onclick="tela_home()">
        <img
          onclick="window.location.href='./homeFuncionario.html'"
          src="../assets/img/home_icon.svg"
        />
        <h2 style="color: #7d2de2" id="effectlist">Home</h2>
      </div>

      <div
        class="btn_etiqueta"
        onclick="window.location.href='../dashboard/etiquetas.html'">
        <img src="../assets/img/etiqueta_icon.svg" />
        <h2 style="color: #7d2de2" id="effectlist">Etiquetas</h2>
      </div>

      <div class="btn_historico"
      onclick="window.location.href='../dashboard/historico.html'">
        <img src="../assets/img/historico_icon.svg" />
        <h2 style="color: #7d2de2" id="effectlist">Histórico</h2>
      </div>

      <div
        class="btn_dashboard"
        onclick="window.location.href='../dashboard/Dashboard.html'"
      >
        <img src="../assets/img/dashboard_icon.svg" />
        <h2 style="color: #7d2de2" id="effectlist">Dashboard</h2>
      </div>

      <div
        class="btn_alerta"
        onclick="window.location.href='../dashboard/alertas.html'"
      >
        <img src="../assets/img/alertas_icon.png" />
        <h2 style="color: #7d2de2" id="effectlist">Alertas</h2>
      </div>

      <div class="btn_perfil">
        <img
          onclick="window.location.href='../meuPerfil.html'"
          src="../assets/img/userNavbar.svg"
        />
        <h2 style="color: #7d2de2" id="effectlist">Perfil</h2>
      </div>

      <div class="btn_sair">
        <img onclick="sair()" src="../assets/img/sair_icon.png" />
        <h2 style="color: #7d2de2" id="effectlist">Sair</h2>
      </div>
    </div>
  </div>

</body>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="../js/graficosDashboard.js"></script>
<script src="https://code.iconify.design/3/3.0.0/iconify.min.js"></script>
<script src="https://code.iconify.design/iconify-icon/1.0.0/iconify-icon.min.js"></script>

<script>

  function sair() {
    sessionStorage.clear();
    window.location.href = "../login.html";
  }

  function tela_home() {
    if (sessionStorage.cargoUsuario === "Gerente") {
      window.location = "homeGestor.html";
    } else {
      window.location = "homeFuncionario.html";
    }
  }

  function imgUsuario() {
    var idUsuario = sessionStorage.idUsuario;
    fetch(`/usuarios/imgUsuario/${idUsuario}`, {
      method: "GET",
      headers: {
        "Content-Type": "application/json",
      },
    })
      .then((resposta) => {
        resposta.json().then((data) => {
          console.log(data);
          const imagemUser = data[0].imagemPerfilUsuario;


          if (imagemUser == undefined) {
            imagem_user.innerHTML = `
                <img src="../assets/img/alert.svg" />
                <img id="imgUser" src="../assets/img/user.svg">
                `
          } else {
            imagem_user.innerHTML = `
                <img src="../assets/img/alert.svg" />
                <img id="imgUser" src="${data[0].imagemPerfilUsuario}" style="border-radius: 92px; height: 9vh; width: 4.3vw">
                `
          }

        })
      }).catch(function (resposta) {
        console.log(`#ERRO: ${resposta}`);
        finalizarAguardar();
      });
  }

</script>

</html>



<!--AQUI FICA TUDO SOBRE OS MODAIS---------------------------------------------------------->
<script>
  function aparecerModalAlerta(nome) {
    nome.style.display = 'block';
  }

  function fecharModalAlerta(nome) {
    nome.style.display = 'none';
  }
</script>

<html>
<!-- EXEMPLO DO CARD DE ALERTA--------------->
<div id="modalAlertaUm" class="modalBody">
  <div class="modalReadPlus">
    <div class="containerReadPlus">
      <div class="modalCheck" onclick="fecharModalAlerta(modalAlertaUm)">
         &times;
      </div>

      <button onclick="buttonBack()" class="modalBack">&times;</button>
    </div>
    <h3>RAM </h3>

    <span id="corpoModalAlertaUm" class="corpoModalAlerta">
      <!--ESSA É A PARTE QUE VAI RECEBER OS DADOS-->
      <p>Não foi encontrado nenhum!</p>
      <!--EXEMPLO DE CONTEUDO-->
      <!-- <div class="container_informacoes_alerta">
        <h6>NOME_CAIXA - <a>NIVEL_ALERTA</a></h6>
        <p>USO_DE_X% <a>DATA_HORA_REGISTRO</a></p>
      </div> -->
      <!--FIM EXEMPLO DE CONTEUDO-->

      <!-- <div class="container_informacoes_alerta">
        <h6>NOME_CAIXA - <a>NIVEL_ALERTA</a></h6>
        <p>USO_DE_X% <a>DATA_HORA_REGISTRO</a></p>
      </div> -->

      <!-- <div class="container_informacoes_alerta">
        <h6>NOME_CAIXA - <a>NIVEL_ALERTA</a></h6>
        <p>USO_DE_X% <a>DATA_HORA_REGISTRO</a></p>
      </div> -->

    </span>

    <button class="button8" onclick="redirecionarMeusCaixas()">Visualizar Caixas</button>
    <!--PASSA O ID DO MODAL-->
  </div>
</div>
<!-- EXEMPLO DO CARD DE ALERTA--------------->

<div id="modalAlertaDois" class="modalBody">
  <div class="modalReadPlus">
    <div class="containerReadPlus">
      <div class="modalCheck" onclick="fecharModalAlerta(modalAlertaDois)">
         &times;
      </div>

      <button onclick="buttonBack()" class="modalBack">&times;</button>
    </div>
    <h3>CPU</h3>

    <span id="corpoModalAlertaDois" class="corpoModalAlerta">
      <!--ESSA É A PARTE QUE VAI RECEBER OS DADOS-->
      <p>Não foi encontrado nenhum!</p>
      <!--EXEMPLO DE CONTEUDO-->
      <!-- <div class="container_informacoes_alerta"> -->
        <!-- <h6>NOME_CAIXA - <a>NIVEL_ALERTA</a></h6>
        <p>USO_DE_X% <a>DATA_HORA_REGISTRO</a></p>
      </div> -->
      <!--FIM EXEMPLO DE CONTEUDO-->

      <!-- <div class="container_informacoes_alerta">
        <h6>NOME_CAIXA - <a>NIVEL_ALERTA</a></h6>
        <p>USO_DE_X% <a>DATA_HORA_REGISTRO</a></p>
      </div>

      <div class="container_informacoes_alerta">
        <h6>NOME_CAIXA - <a>NIVEL_ALERTA</a></h6>
        <p>USO_DE_X% <a>DATA_HORA_REGISTRO</a></p>
      </div> -->

    </span>

    <button class="button8" onclick="redirecionarMeusCaixas()">Visualizar Caixas</button>
  </div>
</div>

<div id="modalAlertaTres" class="modalBody">
  <div class="modalReadPlus">
    <div class="containerReadPlus">
      <div class="modalCheck" onclick="fecharModalAlerta(modalAlertaTres)">
         &times;
      </div>

      <button onclick="buttonBack()" class="modalBack">&times;</button>
    </div>
    <h3>Disco</h3>

    <span id="corpoModalAlertaTres" class="corpoModalAlerta">
      <!--ESSA É A PARTE QUE VAI RECEBER OS DADOS-->
      <p>Não foi encontrado nenhum!</p>
      <!--EXEMPLO DE CONTEUDO-->
      <!-- <div class="container_informacoes_alerta">
        <h6>NOME_CAIXA - <a>NIVEL_ALERTA</a></h6>
        <p>USO_DE_X% <a>DATA_HORA_REGISTRO</a></p>
      </div> -->
      <!--FIM EXEMPLO DE CONTEUDO-->

      <div class="container_informacoes_alerta">
        <!-- <h6>NOME_CAIXA - <a>NIVEL_ALERTA</a></h6>
        <p>USO_DE_X% <a>DATA_HORA_REGISTRO</a></p> -->
      </div>

      <div class="container_informacoes_alerta">
        <!-- <h6>NOME_CAIXA - <a>NIVEL_ALERTA</a></h6>
        <p>USO_DE_X% <a>DATA_HORA_REGISTRO</a></p> -->
      </div>

    </span>



    <button class="button8" onclick="redirecionarMeusCaixas()">Visualizar Caixas</button>
  </div>
</div>

<div id="modalAlertaQuatro" class="modalBody">
  <div class="modalReadPlus">
    <div class="containerReadPlus">
      <div class="modalCheck" onclick="fecharModalAlerta(modalAlertaQuatro)">
         &times;
      </div>

      <button onclick="buttonBack()" class="modalBack">&times;</button>
    </div>
    <h3>modalAlertaQuatro </h3>

    <span id="corpoModalAlertaQuatro" class="corpoModalAlerta">
      <!--ESSA É A PARTE QUE VAI RECEBER OS DADOS-->
      <!--EXEMPLO DE CONTEUDO-->
      <div class="container_informacoes_alerta">
        <h6>NOME_CAIXA - <a>NIVEL_ALERTA</a></h6>
        <p>USO_DE_X% <a>DATA_HORA_REGISTRO</a></p>
      </div>
      <!--FIM EXEMPLO DE CONTEUDO-->

      <div class="container_informacoes_alerta">
        <h6>NOME_CAIXA - <a>NIVEL_ALERTA</a></h6>
        <p>USO_DE_X% <a>DATA_HORA_REGISTRO</a></p>
      </div>

      <div class="container_informacoes_alerta">
        <h6>NOME_CAIXA - <a>NIVEL_ALERTA</a></h6>
        <p>USO_DE_X% <a>DATA_HORA_REGISTRO</a></p>
      </div>

    </span>



    <button class="button8" onclick="redirecionarMeusCaixas()">Visualizar Caixas</button>
  </div>
</div>

</html>

<script>
  var dataAtual = new Date();
  var hora = dataAtual.getHours();
  var nome = sessionStorage.nomeUsuario;
  var bemVindo = document.getElementById("bem_vindo");
  var frase;

  if (hora >= 6 && hora < 13) {
    frase = `Bom dia`;
  } else if (hora >= 13 && hora < 18) {
    frase = `Boa tarde`;
  } else {
    frase = `Boa noite`;
  }

  bem_vindo.innerHTML = `${frase}<span style="color:#7D2DE2;"> ${nome}</span>, hoje tivemos <span style="color:#7D2DE2;"> x</span> alertas registrados `
</script>



<script>

  function carregarDiaAtual() {
    var date = new Date();
    const timeElapsed = Date.now();
    const diaAtual = new Date(timeElapsed).toLocaleDateString();
    const diaAtualFormatado = diaAtual.split('/').reverse().join('-');
    input_filtro_data.value = diaAtualFormatado;
  }

  function redirecionarMeusCaixas(){
    window.location.href = "./meusCaixas.html";
  }

  function filtrarData() {
    input_filtro_data.value = input_filtro_data.value;
    carregarAlertas();
    exibirQtdTotalCaixasRam();
    exibirQtdTotalCaixasCpu();
    exibirQtdTotalCaixasDisco();
  }

  function exibirQtdTotalAlertasDoDia() {
    const dataAtual = input_filtro_data.value
    
    fetch(`/usuarios/exibirQtdTotalAlertasDoDia/${dataAtual}`, {
            method: "GET",
            headers: {
                "Content-Type": "application/json"
            }
    }).then((resposta) => {
        resposta.json().then((data) => {
          console.log(data);
          var totalAlertas = data[0].quantidadeTotalAlertas;

          bem_vindo.innerHTML = `${frase}<span style="color:#7D2DE2;"> ${nome}</span>, hoje tivemos <span style="color:#7D2DE2;">${totalAlertas}</span> alertas registrados `
          
        });
      })
      .catch(function (resposta) {
        console.log(`#ERRO: ${resposta}`);
        finalizarAguardar();
      });
  }

  function exibirQtdTotalCaixasRam() {
    const dataAtual = input_filtro_data.value
    fetch(`/usuarios/exibirQtdTotalCaixasRam/${dataAtual}`, {
            method: "GET",
            headers: {
                "Content-Type": "application/json"
            }
    }).then((resposta) => {
        resposta.json().then((data) => {
          console.log(data);
          var totalQtdCaixasRam = data[0].quantidadeTotalMaquinas;
          qtd_caixas_ram.innerHTML = totalQtdCaixasRam
          
        });
      })
      .catch(function (resposta) {
        console.log(`#ERRO: ${resposta}`);
        finalizarAguardar();
      });
  }

  function exibirQtdTotalCaixasCpu() {
    const dataAtual = input_filtro_data.value
    fetch(`/usuarios/exibirQtdTotalCaixasCpu/${dataAtual}`, {
            method: "GET",
            headers: {
                "Content-Type": "application/json"
            }
    }).then((resposta) => {
        resposta.json().then((data) => {
          console.log(data);
          var totalQtdCaixasCpu = data[0].quantidadeTotalMaquinas;
          qtd_caixas_cpu.innerHTML = totalQtdCaixasCpu
          
        });
      })
      .catch(function (resposta) {
        console.log(`#ERRO: ${resposta}`);
        finalizarAguardar();
      });
  }

  function exibirQtdTotalCaixasDisco() {
    const dataAtual = input_filtro_data.value
    fetch(`/usuarios/exibirQtdTotalCaixasDisco/${dataAtual}`, {
            method: "GET",
            headers: {
                "Content-Type": "application/json"
            }
    }).then((resposta) => {
        resposta.json().then((data) => {
          console.log(data);
          var totalQtdCaixasDisco = data[0].quantidadeTotalMaquinas;
          qtd_caixas_disco.innerHTML = totalQtdCaixasDisco
          
        });
      })
      .catch(function (resposta) {
        console.log(`#ERRO: ${resposta}`);
        finalizarAguardar();
      });
  }

  function exibirDataAtual() {
    var date = new Date();

    const timeElapsed = Date.now();
    const today = new Date(timeElapsed).toISOString();
    return today;
  }

    function carregarAlertas() {
      if (input_filtro_data.value =='') {
        input_filtro_data.value == "'" + exibirDataAtual() + "'";
      }
        var dataAlerta = input_filtro_data.value;
        console.log(dataAlerta)

    var anoAtual = dataAlerta[0] + dataAlerta[1] + dataAlerta[2] + dataAlerta[3]
    var mesAtual = dataAlerta[5] + dataAlerta[6]
    var diaAtual = dataAlerta[8] + dataAlerta[9]
    console.log(`Ano atual: ${anoAtual} Mes atual: ${mesAtual} Dia atual: ${diaAtual}`)
      
        fetch(`/usuarios/obterAlertasPorData/${anoAtual}/${mesAtual}/${diaAtual}`, {
            method: "GET",
            headers: {
                "Content-Type": "application/json"
            }
          }).then((resposta) => {
          resposta.json().then((data) => {
          console.log(data);

                
            listaNomeCaixa = []
            listaComponente = []
            listaNivelAlerta = []
            listaValor = []
            listaData = []

                corpoModalAlertaUm.innerHTML = ``
                corpoModalAlertaDois.innerHTML = ``
                corpoModalAlertaTres.innerHTML = ``
                corpoModalAlertaQuatro.innerHTML = ``

                // corpoModalAlertaUm.innerHTML = `                <p>Não foi encontrado nenhum!</p>`
                // corpoModalAlertaDois.innerHTML = `                <p>Não foi encontrado nenhum!</p>`
                // corpoModalAlertaTres.innerHTML = `                <p>Não foi encontrado nenhum!</p>`
                // corpoModalAlertaQuatro.innerHTML = `                <p>Não foi encontrado nenhum!</p>`

                console.log("limpei os innerHTML")

                for (var i = 0; i < data.length; i++) {
                    var nomeCaixa = data[i].Nome;
                    var componente = data[i].Componente;
                    var nivelAlerta = data[i].Nivel;
                    var valorDado = data[i].Dado;
                    var dataHora = data[i].DataHora;

                    if (dataHora != null)
                    var dataHoraFormatada = dataHora.replaceAll("T", " ").replaceAll("Z", "").replaceAll(".000", "");

                    listaNomeCaixa.push(nomeCaixa)
                    listaComponente.push(componente)
                    listaNivelAlerta.push(nivelAlerta)
                    listaValor.push(valorDado)
                    listaData.push(dataHora)

                    if (listaComponente[i] == "ram") {
                      corpoModalAlertaUm.innerHTML += ` <div class="container_informacoes_alerta"> <h6>${nomeCaixa} - <a>${nivelAlerta}</a></h6> <p>USO_DE_${valorDado}% <a>${dataHoraFormatada}</a></p> </div> `
                      console.log("Inserir um alerta ram")
                    }
                    else if (listaComponente[i] == "cpu") {
                      corpoModalAlertaDois.innerHTML += `
                      <div class="container_informacoes_alerta">
                      <h6>${nomeCaixa} - <a>${nivelAlerta}</a></h6>
                      <p>USO_DE_${valorDado}% <a>${dataHoraFormatada}</a></p>
                      </div>
                      `
                    }
                    else if (listaComponente[i] == "disco") {
                      corpoModalAlertaTres.innerHTML += `
                      <div class="container_informacoes_alerta">
                      <h6>${nomeCaixa} - <a>${nivelAlerta}</a></h6>
                      <p>USO_DE_X${valorDado} <a>${dataHoraFormatada}</a></p>
                      </div>
                      `
                    }
                }
            })

        }).catch(function (resposta) {
            console.log(`#ERRO: ${resposta}`);
        });
    }
</script>
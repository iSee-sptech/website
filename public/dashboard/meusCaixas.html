<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="shortcut icon" href="../assets/img/iconLogo.ico" type="image/x-icon" />
  <title>Meus Caixas - ISee</title>
  <link rel="stylesheet" href="../css/meusCaixas.css" />
  <link rel="stylesheet" href="../css/NavBarSemDescricao.css" />
  <link rel="stylesheet" href="../css/styleModal.css" />
  <link rel="stylesheet" href="../css/efeitoToltipDescricao.css" />
</head>

<body onload="exibirCaixas(), listarCaixas(), imgUsuario()">
  <div class="divTitulo">
    <div class="containerTitulo">
      <h1>Meus Caixas</h1>
      <h6 id="bem_vindo"></h6>
      <div id="imagem_user" class="notificacoes">
        <img src="../assets/img/alert.svg" />
        <img src="../assets/img/user.svg" />
      </div>
    </div>

    <div class="divPesquisa">
      <div>
        <h3>Pesquisar Caixa</h3>
        <input type="text" id="pesquisarCaixaID">
        <button class="button1" onblur="
         setTimeout(() => {
          listarCaixas()
            }, 500);
        " onclick="pesquisarCaixa()">Pesquisar</button>
      </div>
    </div>
  </div>

  <!-- ADICIONAR MAIS CAIXAS COM FUNÇÃO -->

  <div class="meusCaixas" id="divDaddy">
    <!-- <div id="caixa">
      <div>
        <h2>Status</h2>
        <div id="status"></div>
      </div>

      <div>
        <h2>ID</h2>
        <h4 class="alignCaixa"></h4>
      </div>

      <div>
        <h2>Nome</h2>
        <h4 class="alignCaixa"></h4>
      </div>

      <div>
        <h2>CEP</h2>
        <h4 class="alignCaixa"></h4>
      </div>

       <div> Precisamos criar tabela alerta e func count alertas
        <h2>Alertas</h2>
        <h4 class="alignCaixa"></h4>
      </div> 

       <div> Criar func count Etiquetas
        <h2>Etiquetas</h2>
        <h4 class="alignCaixa"></h4>
      </div> 

      <div>
        <h2>RAM</h2>
        <h4 class="alignCaixa"></h4>
      </div>

      <div>
        <h2>Disco</h2>
        <h4 class="alignCaixa"></h4>
      </div>

      <div>
        <h2>Processador</h2>
        <h4 class="alignCaixa"></h4>
      </div>

      <div>
        <h2>Tempo de Atividade</h2>
        <h4 class="alignCaixa"></h4>
      </div>

      <div>
        <h2>Sistema Operacional</h2>
        <h4 class="alignCaixa"></h4>
      </div>

      <div>
        <h2>Fabricante</h2>
        <h4 class="alignCaixa"></h4>
      </div>

      <div>
        <h2>Arquitetura</h2>
        <h4 class="alignCaixa"></h4>
      </div>

      <div>
        <h2>Imagem</h2>
        <div class="alignCaixa" id="ImagemCaixa"><img src="../assets/img/imgCaixa.svg"></div>
      </div>

      <div>
        <h2>Remover</h2>
        <div class="alignCaixa" id="removerCaixa" onclick=""><img src="../assets/img/trashIcon.svg" alt=""></div>
      </div>
    </div> -->
  </div>

  <!-- ADICIONAR MAIS CAIXAS COM FUNÇÃO ^^^^^^^^^^-->

  <div class="container_navbar">
    <div class="navbar_bottom">
      <div class="btn_home" onclick="tela_home()">
        <img onclick="window.location.href='./homeFuncionario.html'" src="../assets/img/home_icon.svg" />
        <h2 style="color: #7d2de2" id="effectlist">Home</h2>
      </div>

      <div class="btn_etiqueta" onclick="window.location.href='../dashboard/etiquetas.html'">
        <img src="../assets/img/etiqueta_icon.svg" />
        <h2 style="color: #7d2de2" id="effectlist">Etiquetas</h2>
      </div>

      <div class="btn_historico">
        <img src="../assets/img/historico_icon.svg" />
        <h2 style="color: #7d2de2" id="effectlist">Histórico</h2>
      </div>

      <div class="btn_dashboard" onclick="window.location.href='../dashboard/Dashboard.html'">
        <img src="../assets/img/dashboard_icon.svg" />
        <h2 style="color: #7d2de2" id="effectlist">Dashboard</h2>
      </div>

      <div class="btn_alerta" onclick="window.location.href='../dashboard/alertas.html'">
        <img src="../assets/img/alertas_icon.png" />
        <h2 style="color: #7d2de2" id="effectlist">Alertas</h2>
      </div>

      <div class="btn_perfil">
        <img onclick="window.location.href='../meuPerfil.html'" src="../assets/img/userNavbar.svg" />
        <h2 style="color: #7d2de2" id="effectlist">Perfil</h2>
      </div>

      <div class="btn_sair">
        <img onclick="sair()" src="../assets/img/sair_icon.png" />
        <h2 style="color: #7d2de2" id="effectlist">Sair</h2>
      </div>
    </div>
  </div>

  <div id="modal" class="modalBody">
    <div id="modal2" class="modalReadPlus">
      <div class="containerReadPlus">
        <div class="modalCheck">
          <img id="modalImg" src="" alt="check" />
        </div>
        <button onclick="buttonBack()" class="modalBack">&times;</button>
      </div>
      <span id="modalText"></span>
      <button class="button8" onclick="buttonBack()">Fechar</button>
    </div>
  </div>

</body>

</html>

<script>

  function buttonBack() {
    modal.style.display = "none";
  }

  var dataAtual = new Date();
  var hora = dataAtual.getHours();
  var nome = sessionStorage.nomeUsuario;
  var bemVindo = document.getElementById("bem_vindo");
  var frase;

  if (hora >= 6 && hora < 13) {
    frase = `Bom dia`;
  } else if (hora >= 13 && hora < 18) {
    frase = `Boa tarde`;
  } else {
    frase = `Boa noite`;
  }

  //Bom dia Yuri, Total de Caixas

  function sair() {
    sessionStorage.clear();
    window.location.href = "../login.html";
  }

  function tela_home() {
    if (sessionStorage.cargoUsuario === "Gerente") {
      window.location = "homeGestor.html";
    } else {
      window.location = "homeFuncionario.html";
    }
  }

  function exibirCaixas() {
    fetch(`/usuarios/exibirCaixas`, {
      method: "GET",
      headers: {
        "Content-Type": "application/json",
      },
    })
      .then((resposta) => {
        // saldoConta
        resposta.json().then((data) => {
          console.log(data);
          qtdCaixa = data[0].qtdCaixa;
          quantidadeCaixas = qtdCaixa;
          bem_vindo.innerHTML = `${frase}<span style="color:#7D2DE2;"> ${nome}</span>, total de <span style="color:#7D2DE2;">${quantidadeCaixas}</span> caixas`;
        });
      })
      .catch(function (resposta) {
        console.log(`#ERRO: ${resposta}`);
      });
  }

  function listarCaixas() {
    fetch(`/usuarios/listarCaixas`, {
      method: "GET",
      headers: {
        "Content-Type": "application/json",
      },
    })
      .then((resposta) => {
        listaID = [];
        listaNome = [];
        listaCep = [];
        listaRam = [];
        listaDisco = [];
        listaProcessador = [];
        listaTempo = [];
        listaSO = [];
        listaFabricante = [];
        listaArquitetura = [];
        listaImg = [];

        resposta.json().then((data) => {
          console.log(data);
          divDaddy.innerHTML = ``
          for (var i = 0; i < data.length; i++) {
            var id = data[i].idMaquina;
            var nome = data[i].nomeMaquina;
            var cep = data[i].cepMaquina;
            var ram = data[i].ramMaquina;
            ram = ram && ram.substr(0, 2);
            ram = parseInt(ram);
            ram = ram - 1;
            var disco = data[i].discoMaquina;
            disco = disco && disco.substr(0, 3);
            var processador = data[i].processadorMaquina;
            processador = processador && processador.substr(0, 3);
            processador = parseInt(processador);
            processador = processador + 1;
            processador = processador / 100;
            var tempo = data[i].tempoDeAtividade;
            tempo = parseInt(tempo)
            tempo = tempo / 3600
            tempo = Math.round(tempo)
            var so = data[i].sistemaOperacionalMaquina;
            var fabricante = data[i].fabricanteMaquina;
            var arquitetura = data[i].arquiteturaMaquina;
            var img = data[i].imgMaquina;
            listaID.push(id)
            listaNome.push(nome)
            listaCep.push(cep)
            listaRam.push(ram)
            listaDisco.push(disco)
            listaProcessador.push(processador)
            listaTempo.push(tempo)
            listaSO.push(so)
            listaFabricante.push(fabricante)
            listaArquitetura.push(arquitetura)
            listaImg.push(img)



            divDaddy.innerHTML += ` <div id="caixa" style="padding-bottom: 4%;">
      <div>
        <h2>Status</h2>
        <div id="status"></div>
      </div>

      <div>
        <h2>ID</h2>
        <h4 class="alignCaixa">${listaID[i]}</h4>
      </div>

      <div>
        <h2>Nome</h2>
        <h4 class="alignCaixa">${listaNome[i]}</h4>
      </div>

      <div>
        <h2>CEP</h2>
        <h4 class="alignCaixa">${listaCep[i]}</h4>
      </div>

      <!-- <div> Precisamos criar tabela alerta e func count alertas
        <h2>Alertas</h2>
        <h4 class="alignCaixa"></h4>
      </div> -->

      <!-- <div> Criar func count Etiquetas
        <h2>Etiquetas</h2>
        <h4 class="alignCaixa"></h4>
      </div> -->

      <div>
        <h2>RAM</h2>
        <h4 class="alignCaixa">${listaRam[i]} GB</h4>
      </div>

      <div>
        <h2>Disco</h2>
        <h4 class="alignCaixa">${listaDisco[i]} GB</h4>
      </div>

      <div>
        <h2>Processador</h2>
        <h4 class="alignCaixa">${listaProcessador[i]} GHz</h4>
      </div>

      <div>
        <h2>Tempo de Atividade</h2>
        <h4 class="alignCaixa">${listaTempo[i]} Horas</h4>
      </div>

      <div>
        <h2>Sistema Operacional</h2>
        <h4 class="alignCaixa">${listaSO[i]}</h4>
      </div>

      <div>
        <h2>Fabricante</h2>
        <h4 class="alignCaixa">${listaFabricante[i]}</h4>
      </div>

      <div>
        <h2>Arquitetura</h2>
        <h4 class="alignCaixa">${listaArquitetura[i]}</h4>
      </div>

      <div>
        <h2>Imagem</h2>
        
        <div class="alignCaixa" id="ImagemCaixa" onclick="openModal('${listaImg[i]}')"><img src="../assets/img/imgCaixa.svg"></div>
      </div>

      <div>
        <h2>Remover</h2>
        <div class="alignCaixa" id="removerCaixa" onclick="removerCaixa(${listaID[i]})"><img src="../assets/img/trashIcon.svg" alt=""></div>
      </div>
    </div>`;
          }
        });
      })
      .catch(function (resposta) {
        console.log(`#ERRO: ${resposta}`);
      });
  }

  function pesquisarCaixa() {
    var idPesquisarCaixa = pesquisarCaixaID.value;
    idPesquisar = parseInt(idPesquisarCaixa);
    const idCaixa = idPesquisar;
    console.log(idCaixa)

    fetch(`/usuarios/pesquisarCaixa${idCaixa}`, {
      method: "GET",
      headers: {
        "Content-Type": "application/json",
      },
    })
      .then((resposta) => {
        resposta.json().then((data) => {
          console.log(data);

          var id = data[0].idMaquina;
          var nome = data[0].nomeMaquina;
          var cep = data[0].cepMaquina;
          var ram = data[0].ramMaquina;
          ram = ram && ram.substr(0, 2);
          ram = parseInt(ram);
          ram = ram - 1;
          var disco = data[0].discoMaquina;
          disco = disco && disco.substr(0, 3);
          var processador = data[0].processadorMaquina;
          processador = processador && processador.substr(0, 3);
          processador = parseInt(processador);
          processador = processador + 1;
          processador = processador / 100;
          var tempo = data[0].tempoDeAtividade;
          tempo = parseInt(tempo);
          tempo = tempo / 3600;
          tempo = Math.round(tempo);
          var so = data[0].sistemaOperacionalMaquina;
          var fabricante = data[0].fabricanteMaquina;
          var arquitetura = data[0].arquiteturaMaquina;
          var img = data[0].imgMaquina;

          divDaddy.innerHTML = ` <div id="caixa" style="padding-bottom: 4%;">
      <div>
        <h2>Status</h2>
        <div id="status"></div>
      </div>

      <div>
        <h2>ID</h2>
        <h4 class="alignCaixa">${id}</h4>
      </div>

      <div>
        <h2>Nome</h2>
        <h4 class="alignCaixa">${nome}</h4>
      </div>

      <div>
        <h2>CEP</h2>
        <h4 class="alignCaixa">${cep}</h4>
      </div>

      <!-- <div> Precisamos criar tabela alerta e func count alertas
        <h2>Alertas</h2>
        <h4 class="alignCaixa"></h4>
      </div> -->

      <!-- <div> Criar func count Etiquetas
        <h2>Etiquetas</h2>
        <h4 class="alignCaixa"></h4>
      </div> -->

      <div>
        <h2>RAM</h2>
        <h4 class="alignCaixa">${ram} GB</h4>
      </div>

      <div>
        <h2>Disco</h2>
        <h4 class="alignCaixa">${disco} GB</h4>
      </div>

      <div>
        <h2>Processador</h2>
        <h4 class="alignCaixa">${processador} GHz</h4>
      </div>

      <div>
        <h2>Tempo de Atividade</h2>
        <h4 class="alignCaixa">${tempo} Horas</h4>
      </div>

      <div>
        <h2>Sistema Operacional</h2>
        <h4 class="alignCaixa">${so}</h4>
      </div>

      <div>
        <h2>Fabricante</h2>
        <h4 class="alignCaixa">${fabricante}</h4>
      </div>

      <div>
        <h2>Arquitetura</h2>
        <h4 class="alignCaixa">${arquitetura}</h4>
      </div>

      <div>
        <h2>Imagem</h2>
        <div class="alignCaixa" id="ImagemCaixa"><img src="../assets/img/imgCaixa.svg"></div>
      </div>

      <div>
        <h2>Remover</h2>
        <div class="alignCaixa" id="removerCaixa" onclick="removerCaixaFiltro()"><img src="../assets/img/trashIcon.svg" alt=""></div>
      </div>
    </div>`;
        });
      })
      .catch(function (resposta) {
        console.log(`#ERRO: ${resposta}`);
      });
  }

  function imgUsuario() {
    var idUsuario = sessionStorage.idUsuario;
    fetch(`/usuarios/imgUsuario/${idUsuario}`, {
      method: "GET",
      headers: {
        "Content-Type": "application/json",
      },
    })
      .then((resposta) => {
        resposta.json().then((data) => {
          console.log(data);
          const imagemUser = data[0].imagemPerfilUsuario;

          if (imagemUser == undefined) {
            imagem_user.innerHTML = `
                <img src="../assets/img/alert.svg" />
                <img id="imgUser" src="../assets/img/user.svg">
                `;
          } else {
            imagem_user.innerHTML = `
                <img src="../assets/img/alert.svg" />
                <img id="imgUser" src="${data[0].imagemPerfilUsuario}" style="border-radius: 92px; height: 9vh; width: 4.3vw">
                `;
          }
        });
      })
      .catch(function (resposta) {
        console.log(`#ERRO: ${resposta}`);
        finalizarAguardar();
      });
  }


  function removerCaixa(id) {
    var idVar = id;

    fetch("/usuarios/removerCaixa", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({
        idServer: idVar,
      }),
    }).then((response) => {
      response.json().then((data) => {
        const msg = data.mensagem;

        console.log(msg);
        if (msg == "success") {
          listarCaixas()
          modal.style.display = "block";
          modal.style.witdh = "block";
          modalImg.src = "../assets/img/iconCheck.svg";
          modalText.innerHTML = `Sucesso ao deletar caixa ${id}`;

        } else {
          console.log("Houve um erro ao tentardeletar caixa");
        }
      });
    });
  }

  function removerCaixaFiltro() {
    var idVar = pesquisarCaixaID.value;
    console.log(idVar)


    fetch("/usuarios/removerCaixaFiltro", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({
        idServer: idVar,
      }),
    }).then((response) => {
      response.json().then((data) => {
        const msg = data.mensagem;

        console.log(msg);
        if (msg == "success") {
          listarCaixas()
          modal.style.display = "block";
          modalImg.src = "../assets/img/iconCheck.svg";
          modalText.innerHTML = `Sucesso ao deletar caixa ${idVar}`;

        } else {
          console.log("Houve um erro ao tentardeletar caixa");
        }
      });
    });
  }

  function openModal(url) {
    urlImage = url;
    modal.style.display = "block";
    var modal2 = document.querySelector(".modalReadPlus"); m = modal2.style;
    
    m.width = "50%";
    m.height = "60%";
   // m.gap = "34%";

   var modal3 = document.querySelector(".modalCheck"); m3 = modal3.style;

    m3.width = "42vw";
    m3.height = "42vh";
    m3.marginTop = "0vh";
    m3.paddingBottom = "0%";
    // m3.alignItems = "center";
    // m3.justifyContent = "center";
     

    var modal4 = document.querySelector(".button8"); m4 = modal4.style;
    
    m4.marginTop = "36vh";

    modalImg.src = `${urlImage}`;
    
  }


</script>